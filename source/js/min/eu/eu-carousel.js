define(["jquery","jqScrollto","resize"],function(a){return function(b,c){log=function(a){console.log(a)};var d,e,f,g=1,b=a(b),h=15,i=h,j=0,k=c.length,l=100,m=!1,n=1e3,o={arrowClasses:{container:"js-mlt-arrows",left:"left",right:"right"},itemClass:"mlt-item",itemDivClass:"mlt-img-div height-to-width",itemInnerClass:"inner",itemLinkClass:"link",titleClass:"mlt-title"},p=function(){log("resizing");var a=b.width(),c=f.find("."+o.itemClass).first().outerWidth(),d=parseInt(a/(c+h));i=h,1==d?(i=(a-c)/2,i+=2):i=(a-d*c)/(d-1),i=parseInt(i),log("w = "+a+"spacing will be "+i+", maxFit = "+d),j=d,f.find("."+o.itemClass).css("margin-left",parseInt(i)+"px"),log("w: "+a+", itemW: "+c+", maxFit "+d),1!=d&&f.find("."+o.itemClass+":first").css("margin-left","0px"),f.css("width",a+k*(c+i));var e=function(){m=!0,b.css("overflow-x","hidden"),f.css("left","0"),b.scrollTo(f.find("."+o.itemClass+":nth-child("+g+")"),1==j?0:n,{axis:"x",onAfter:function(){var a=function(){b.css("overflow-x","hidden"),m=!1,q()};if(1==j){f.find("."+o.itemClass+":first").css("margin-left");f.css("left",i+"px")}else f.css("left","0");a()}})};e()},q=function(){1==g?d.hide():d.show(),l>k||k>=g+j?e.show():(log("hide right arrow: position "+g+" + inView "+j+" <= "+k),e.hide())},r=function(){m=!0;var a=1>g-j?1:g-j;log("prev index = "+a),g=a,a=f.find("."+o.itemClass+":nth-child("+a+")"),b.css("overflow-x","hidden"),f.css("left","0"),b.scrollTo(a,1==j?0:1e3,{axis:"x",onAfter:function(){var a=function(){b.css("overflow-x","hidden"),m=!1,q()};if(1==j){f.find("."+o.itemClass+":first").css("margin-left");f.css("left",i+"px")}else f.css("left","0");a()}})},s=function(){var a=g+j,c=f.find("."+o.itemClass+":nth-child("+a+")");g=a,b.css("overflow-x","hidden"),f.css("left","0"),m=!0,b.scrollTo(c,1==j?0:1e3,{axis:"x",onAfter:function(){var a=function(){b.removeClass("loading"),b.css("overflow-x","hidden"),m=!1,q()};if(1==j){f.find("."+o.itemClass+":first").css("margin-left");f.css("left",i+"px")}else f.css("left","0");a(),console.log("b) position "+g+", inView "+j)}})},t=function(){return k>g+j?(log("no going right: -pos="+g+", "+(g+j)+" > "+k),void s()):void u(!0)},u=function(c){if(!b.hasClass("loading")){b.addClass("loading");var d=function(b){a.each(b.documents,function(a,b){f.append(v(b)),k+=1}),p(),c&&s()},e=parseInt(Math.floor(k/j))+1,g=window.location.href.split(".html")[0]+"/similar.json?page="+e+"&per_page="+j;a.getJSON(g,null,function(a){d(a)}).fail(function(a){b.removeClass("loading"),log("failed to load data ("+JSON.stringify(a)+") from url: "+g)})}},v=function(a){return'<li class="'+o.itemClass+'"><div class="'+o.itemDivClass+'" style="background-image: url('+a.img.src+')"><div class="'+o.itemInnerClass+'"><a title="'+a.img.alt+'" class="'+o.itemLinkClass+'" href="'+a.url+'">&nbsp;</a></div></div><span class="'+o.titleClass+'"><a href="'+a.url+'">'+a.title+"</a>"},w=function(){if(f=b.find("ul"),d=a('<a class="'+o.arrowClasses.left+'">◂</a>'),e=a('<a class="'+o.arrowClasses.right+'">▸</a>'),b.before('<div class="'+o.arrowClasses.container+'"></div>'),b.prev("."+o.arrowClasses.container).append(d),b.prev("."+o.arrowClasses.container).append(e),k=f.find("."+o.itemClass).length,"undefined"!=typeof Ellipsis&&a("."+o.itemClass+" .info").each(function(a,b){new Ellipsis(b)}),d.click(function(a){return m||(log("go left...."),r()),a.stopPropagation(),!1}),e.click(function(a){return m||(log("go right...."),t()),a.stopPropagation(),!1}),!a("html").hasClass("ie8")){"undefined"!=typeof b.touchwipe&&b.touchwipe({wipeLeft:function(){e.click()},wipeRight:function(){d.click()},wipeUp:function(){},wipeDown:function(){},min_move_x:20,min_move_y:20,preventDefaultEvents:!0})}"undefined"!=typeof a(window).europeanaResize&&a(window).europeanaResize(function(){p()}),p()};return w(),{resize:function(){p()},inView:function(){return fnInView()},goLeft:function(){r()},goRight:function(){t()}}}});