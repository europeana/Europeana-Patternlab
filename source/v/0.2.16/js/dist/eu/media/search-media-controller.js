define(["jquery"],function(a){function b(a){console.log("search-media-controller: "+a)}function c(){b("hideAllViewers()"),a(".media-viewer .object-media-iiif").addClass("is-hidden"),a(".media-viewer .object-media-image").addClass("is-hidden"),a(".media-viewer .object-media-text").addClass("is-hidden"),a(".media-viewer .multi-item-poster").addClass("is-hidden"),a(".media-viewer .object-media-midi").addClass("is-hidden"),a(".media-viewer .object-media-oembed").addClass("is-hidden"),x&&x.hide(),y&&(y.hide(),y=null),v&&v.hide(),w&&w.hide()}function d(){b("initMedia()")}function e(c){b("remove playability..."),c.$thumb.removeClass("playable"),c.$thumb.find(".media-clickable-indicator").remove(),a(s).removeClass("loading"),a(t).removeClass("loading"),a(".media-viewer .object-media-"+c.player).addClass("is-hidden")}function f(b,c){a(".media-viewer").removeClass("active"),a(".media-viewer .multi-item-poster").removeClass("is-hidden"),"image"==c.type&&(a(window).trigger("updateTechData",{selector:'*[data-uri="'+c.current+'"]'}),a(".multi-item-poster img").attr("src",c.current))}function g(b,c){c.hide_thumb&&(a(q).addClass("open"),a(r).addClass("open")),a(s).removeClass("loading"),a(t).removeClass("loading"),a(".media-viewer").addClass("active"),"image"!=c.type&&a(".media-viewer").trigger({type:"refresh-nav-carousel"})}function h(d,e){c(),a(".media-viewer .object-media-audio").removeClass("is-hidden"),require(["media_viewer_videojs"],function(c){x=c;var d=x.getItemFromMarkup(e.target);d?x.init(d):(a(".media-viewer").trigger({type:"remove-playability",$thumb:e.target,player:"audio"}),b("missing audio item - removed"))})}function i(d,e){b("initMediaIIIF() "+e.url),c(),a(".media-viewer .object-media-iiif").removeClass("is-hidden"),require(["leaflet"],function(a){require(["media_viewer_iiif"],function(a){y=a,y.init(e.url,e.target)})})}function j(d,f){b("initMediaImage()   "+u);var g=[],h=f.target.attr("data-uri");a(s+"[data-type=image]").add(t+"[data-type=image]").each(function(){var c=a(this),d=c.attr("data-uri"),e=c.attr("data-height"),f=c.attr("data-width");d&&f&&e&&f.length>0&&e.length>0?(b("add img: "+d+", w "+f+", h "+e),g.push({src:d,h:parseInt(e),w:parseInt(f)})):b("incomplete image data")}),require(["media_viewer_image"],function(b){u=b,c(),a(".media-viewer .object-media-image").removeClass("is-hidden"),u.init(g,h)||e({$thumb:a(f.target)})})}function k(b,d){c(),z?(a(".media-viewer .object-media-midi").removeClass("is-hidden"),z.init(d.url)):require(["media_player_midi"],function(b){z=b,a(".media-viewer .object-media-midi").removeClass("is-hidden"),z.init(d.url)})}function l(b,d){c();var e=a(".media-viewer .object-media-oembed");A?(e.removeClass("is-hidden"),A.init(e,d.html)):require(["media_player_oembed"],function(a){A=a,e.removeClass("is-hidden"),A.init(e,d.html)})}function m(d,e){b("initMediaPdf(): "+e.url),e.url&&e.url.length>0&&(v?(c(),v.show(),v.init(e.url)):require(["jquery"],function(){require(["pdfjs"],function(){require(["pdf_lang"],function(){require(["media_viewer_pdf"],function(b){c(),a(".media-viewer .object-media-pdf").removeClass("is-hidden"),v=b,v.init(e.url)})})})}))}function n(d,e){c(),a(".media-viewer .object-media-video").removeClass("is-hidden"),require(["media_viewer_videojs"],function(c){w=c;var d=w.getItemFromMarkup(e.target);d?w.init(d):(a(".media-viewer").trigger({type:"remove-playability",$thumb:e.target,player:"video"}),b("missing video item - removed"))})}function o(c){if(a(this).hasClass("disabled"))return b("return because media link disabled"),void c.preventDefault();if(a(this).hasClass("playable")){a(this).addClass("loading");var d=a(this).attr("data-type");console.log("media controller will trigger eventobject-media-"+d),a(".media-viewer").trigger("object-media-"+d,{url:a(this).attr("data-uri"),thumbnail:a(this).data("thumbnail"),html:a(this).data("html"),target:a(this)}),c.preventDefault()}else b("media item not playable")}var p=".multi-item-poster a",q=".object-media-nav",r=".single-item-thumb",s=q+" a",t=r+" a",u=(a(s).length>1,null),v=null,w=null,x=null,y=null,z=null,A=null;a(p).on("click",function(b){var c=a(b.target).closest("a"),d=c.data("uri");a(s).each(function(b,c){var e=a(c);return e.data("uri")==d?(e.click(),!1):void 0})}),a(".media-viewer").on("media_init",d),a(".media-viewer").on("object-media-audio",h),a(".media-viewer").on("object-media-iiif",i),a(".media-viewer").on("object-media-image",j),a(".media-viewer").on("object-media-midi",k),a(".media-viewer").on("object-media-oembed",l),a(".media-viewer").on("object-media-pdf",m),a(".media-viewer").on("object-media-video",n),a(".media-viewer").on("object-media-open",g),a(".media-viewer").on("object-media-close",f),a(".media-viewer").on("remove-playability",e),a(q).on("click","a",o),a(t).on("click",o)});