define(["jquery","jqScrollto","touch_move","touch_swipe","util_resize"],function(a){var b=function(a){console.log("carousel: "+a)},c=function(a,b){for(item in a)b[item]=a[item];return b},d=function(d,e,f){var g,h,i,j,k,l,m,n=null,o=null,p=null,q=null,r="left",s=!1,d=a(d),e=e,t=0,u=1,v=e.getDataCount(),w=100,x=400,y=d.find(".js-carousel-item:first"),z=y.width(),A=!1,B=!1,C={};o||d.addClass("h");var D=function(){var e={dynamic:!1,svg:!1,minSpacingPx:15},g=c(f,e);C={arrowClasses:{container:"js-carousel-arrows",back:"left",fwd:"right",content:{back:g.svg?'<svg class="icon icon-previous"><use xlink:href="#icon-previous"/></svg>':"&lt;",fwd:g.svg?'<svg class="icon icon-next"><use xlink:href="#icon-next"/></svg>':"&gt;",up:g.svg?'<svg class="icon icon-caret-up"><use xlink:href="#icon-caret-up"/></svg>':"^",down:g.svg?'<svg class="icon icon-caret-down"><use xlink:href="#icon-caret-down"/></svg>':"^"}},itemClass:"js-carousel-item",itemDivClass:"mlt-img-div height-to-width",itemInnerClass:"inner",itemLinkClass:"link",titleClass:"js-carousel-title"},n="undefined"!=typeof g.bpVertical,p=g.bpVertical,n?(F(),b("carousel will be vertical ("+o+") on breakpoint "+p+" (px)")):o=!1,r=o?"top":"left",k=g.loadUrl,w=g.total_available?g.total_available:w,j=g.minSpacingPx,l=j,i=d.find("ul"),M();var h=Math.min(-100,0-z/2);d.on("movestart",function(b){if(m)return void b.preventDefault();var c=a(b.target);"a"==c[0].nodeName.toLowerCase()&&c.addClass("disabled");var d=b.distX>b.distY&&b.distX<-b.distY||b.distX<b.distY&&b.distX>-b.distY;if(o){if(!d)return void b.preventDefault()}else if(d)return void b.preventDefault()}).on("move",function(a){B=!0,o?(a.distY<0&&(i.css("top",a.distY+"px"),a.distY<h&&(A||u+t+t>v&&(A=!0,L()))),a.distY>0&&i.css("top",a.distY+"px")):(i.css("top","0px"),a.distX<0&&(i.css("left",a.distX+"px"),a.distX<h&&(A||u+t+t>v&&(A=!0,L()))),a.distX>0&&i.css("left",a.distX+"px"))}).on("moveend",function(b){var c=a(b.target);if("a"==c[0].nodeName.toLowerCase()&&setTimeout(function(){c.removeClass("disabled")},1e3),b.stopPropagation(),o){var e=c.height(),f=Math.round(b.distY/(e+l/2)),g=u+-1*f;g==u&&Math.abs(b.distY)>=e/2.5&&(g+=b.distY>0?-1:1),d.scrollTo(d.scrollTop()-parseInt(i.css("top")),0),i.css("top",""),A=!1,B=!1,u=Math.max(1,g),u=Math.min(u,w),G()}else{var f=Math.round(b.distX/(z+l/2)),g=u+-1*f;g==u&&Math.abs(b.distX)>=z/2.5&&(g+=b.distX>0?-1:1),d.scrollTo(d.scrollLeft()-parseInt(i.css("left")),0),i.css("left",""),A=!1,B=!1,u=Math.max(1,g),u=Math.min(u,w),G()}}),"undefined"!=typeof a(window).europeanaResize&&a(window).europeanaResize(function(){var a=x;x=0,G(),x=a}),G()},E=function(){s=!0,i.css(r,"0");var a=i.find("."+C.itemClass+":nth-child("+u+")");d.scrollTo(a,1==t?0:x,{onAfter:function(){var a=function(){s=!1,H()};1==t?(i.find("."+C.itemClass+":first").css("margin-"+r),i.css(r,l+"px")):i.css(r,"0"),a()}})},F=function(){var c=a(document).width()+12;n&&p>c&&(null==o||1==o)?(o=!1,d.removeClass("v"),d.prev(".js-carousel-arrows").removeClass("v"),d.prev(".js-carousel-arrows").addClass("h"),h&&(h.html(C.arrowClasses.content.fwd),g.html(C.arrowClasses.content.back)),i&&(i.css("height","100%"),i.css("width","100%")),r="left",d.find("."+C.itemClass).css("margin-top","0px"),d.find("."+C.itemClass).css("margin-left","0px"),b("switched to horizontal bp("+p+"), w("+c+")"),q&&q(o)):n&&c>=p&&(null==o||0==o)&&(o=!0,d.addClass("v"),d.prev(".js-carousel-arrows").removeClass("h"),d.prev(".js-carousel-arrows").addClass("v"),h&&(h.html(C.arrowClasses.content.down),g.html(C.arrowClasses.content.up)),i&&(i.css("height","100%"),i.css("width","100%")),r="top",d.find("."+C.itemClass).css("margin-top","0px"),d.find("."+C.itemClass).css("margin-left","0px"),b("switched to vertical bp("+p+"), w("+c+")"),q&&q(o))},G=function(){if(B)return void b("!resize (swiping)");F();var a=o?d.height():d.width(),c=null,e=i.find("."+C.itemClass).first(),c=o?e.outerHeight():e.outerWidth();if(d.removeAttr("style"),g.css("display","block"),h.css("display","block"),m=a>=w*c+(w-1)*j)return g.css("display","none"),h.css("display","none"),d.css("display","table"),d.css("width","auto"),d.css("margin","auto"),i.css(o?"height":"width","auto"),i.find("."+C.itemClass).css("margin-left",j+"px"),i.find("."+C.itemClass+":first").css("margin-left","0px"),l=j,void(t=w);var f=parseInt(a/(c+j));f=Math.min(f,w),l=j,1==f?(l=(a-c)/2,l+=2):l=(a-f*c)/(f-1),l=parseInt(l),t=f,i.find("."+C.itemClass).css("margin-"+r,parseInt(l)+"px"),1!=f&&i.find("."+C.itemClass+":first").css("margin-"+r,"0px"),i.css(o?"height":"width",a+v*(c+l)),E()},H=function(){g&&(1==u?g.addClass("arrow-hidden"):g.removeClass("arrow-hidden")),h&&(w>u-1+t?h.removeClass("arrow-hidden"):h.addClass("arrow-hidden"))},I=function(){s=!0;var a=1>u-t?1:u-t;b("prev index = "+a),u=a,a=i.find("."+C.itemClass+":nth-child("+a+")"),i.css(r,"0"),d.scrollTo(a,1==t?0:1e3,{onAfter:function(){var a=function(){s=!1,H()};1==t?(i.find("."+C.itemClass+":first").css("margin-"+r),i.css(r,l+"px")):i.css(r,"0"),a()}})},J=function(){var a=u+t,c=i.find("."+C.itemClass+":nth-child("+a+")");return 0==c.length?(b("cannot scroll forward (return)"),d.removeClass("loading"),void H()):(u=a,i.css(r,"0"),s=!0,void d.scrollTo(c,1==t?0:1e3,{onAfter:function(){var a=function(){d.removeClass("loading"),s=!1,H()};1==t?i.css(r,l+"px"):i.css(r,"0"),a()}}))},K=function(){v>u+t+t?J():L(!0)},L=function(a,c){return k?d.hasClass("loading")?void b("already loading (return)"):v==w?(b("no more to load (scroll and return)"),void(B||J())):(d.addClass("loading ("+t+")"),void e.append(function(f){v=e.getDataCount(),f.length?(G(),b("added > resize > scroll "+a),a?J():d.removeClass("loading"),v==w&&b("loaded all")):0==f.length?b("loaded all (added 0)"):(b("load error: only "+v+" available"),w=v,d.removeClass("loading"),B||J()),c&&c(f)},t)):void b("no load url (return)")},M=function(){g=a('<a class="'+C.arrowClasses.back+'">'+(o?C.arrowClasses.content.up:C.arrowClasses.content.back)+"</a>"),h=a('<a class="'+C.arrowClasses.fwd+'">'+(o?C.arrowClasses.content.down:C.arrowClasses.content.fwd)+"</a>"),d.before('<div class="'+C.arrowClasses.container+(o?" v":" h")+'"></div>'),d.prev("."+C.arrowClasses.container).append(g),d.prev("."+C.arrowClasses.container).append(h),v=i.find("."+C.itemClass).length,g.click(function(a){return s||I(),a.stopPropagation(),!1}),h.click(function(a){return s||K(),a.stopPropagation(),!1})};return D(),{resize:function(){G()},isVertical:function(){return o},vChange:function(a){q=a},inView:function(){return fnInView()},loadMore:function(a,b){L(a,b)},goLeft:function(){console.error("deprecated function call in eu-carousel: goLeft"),I()},goRight:function(){console.error("deprecated function call in eu-carousel: goRight"),K()}}};return{create:function(a,b,c){return d(a,b,c)}}});