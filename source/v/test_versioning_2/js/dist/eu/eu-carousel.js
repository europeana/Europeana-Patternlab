define(["jquery","jqScrollto","touch_move","touch_swipe","util_resize"],function(a){var b=function(a){console.log("carousel: "+a)},c=function(a,b){for(item in a)b[item]=a[item];return b},d=function(d,e,f){var g,h,i,j,k,l,m=null,n=null,o=null,p=null,q="left",r=!1,d=a(d),e=e,s=0,t=1,u=e.getDataCount(),v=100,w=400,x=d.find(".js-carousel-item:first"),y=x.width(),z=!1,A=!1,B={};n||d.addClass("h");var C=function(){var e={dynamic:!1,svg:!1,minSpacingPx:15},g=c(f,e);B={arrowClasses:{container:"js-carousel-arrows",back:"left",fwd:"right",content:{back:g.svg?'<svg class="icon icon-caret-left"><use xlink:href="#icon-caret-left"/></svg>':"&lt;",fwd:g.svg?'<svg class="icon icon-caret-right"><use xlink:href="#icon-caret-right"/></svg>':"&gt;",up:g.svg?'<svg class="icon icon-caret-up"><use xlink:href="#icon-caret-up"/></svg>':"^",down:g.svg?'<svg class="icon icon-caret-down"><use xlink:href="#icon-caret-down"/></svg>':"^"}},itemClass:"js-carousel-item",itemDivClass:"mlt-img-div height-to-width",itemInnerClass:"inner",itemLinkClass:"link",titleClass:"js-carousel-title"},m="undefined"!=typeof g.bpVertical,o=g.bpVertical,m?(E(),b("carousel will be vertical ("+n+") on breakpoint "+o+" (px)")):n=!1,q=n?"top":"left",k=g.loadUrl,v=g.total_available?g.total_available:v,j=g.minSpacingPx,l=j,i=d.find("ul"),L();var h=Math.min(-100,0-y/2);d.on("movestart",function(b){var c=a(b.target);"a"==c[0].nodeName.toLowerCase()&&c.addClass("disabled");var d=b.distX>b.distY&&b.distX<-b.distY||b.distX<b.distY&&b.distX>-b.distY;if(n){if(!d)return void b.preventDefault()}else if(d)return void b.preventDefault()}).on("move",function(a){A=!0,n?(a.distY<0&&(i.css("top",a.distY+"px"),a.distY<h&&(z||t+s+s>u&&(z=!0,K()))),a.distY>0&&i.css("top",a.distY+"px")):(i.css("top","0px"),a.distX<0&&(i.css("left",a.distX+"px"),a.distX<h&&(z||t+s+s>u&&(z=!0,K()))),a.distX>0&&i.css("left",a.distX+"px"))}).on("moveend",function(b){var c=a(b.target);if("a"==c[0].nodeName.toLowerCase()&&setTimeout(function(){c.removeClass("disabled")},1e3),b.stopPropagation(),n){var e=c.height(),f=Math.round(b.distY/(e+l/2)),g=t+-1*f;g==t&&Math.abs(b.distY)>=e/2.5&&(g+=b.distY>0?-1:1),d.scrollTo(d.scrollTop()-parseInt(i.css("top")),0),i.css("top",""),z=!1,A=!1,t=Math.max(1,g),t=Math.min(t,v),F()}else{var f=Math.round(b.distX/(y+l/2)),g=t+-1*f;g==t&&Math.abs(b.distX)>=y/2.5&&(g+=b.distX>0?-1:1),d.scrollTo(d.scrollLeft()-parseInt(i.css("left")),0),i.css("left",""),z=!1,A=!1,t=Math.max(1,g),t=Math.min(t,v),F()}}),"undefined"!=typeof a(window).europeanaResize&&a(window).europeanaResize(function(){var a=w;w=0,F(),w=a}),F()},D=function(){r=!0,i.css(q,"0");var a=i.find("."+B.itemClass+":nth-child("+t+")");d.scrollTo(a,1==s?0:w,{onAfter:function(){var a=function(){r=!1,G()};1==s?(i.find("."+B.itemClass+":first").css("margin-"+q),i.css(q,l+"px")):i.css(q,"0"),a()}})},E=function(){var c=a(document).width()+12;m&&o>c&&(null==n||1==n)?(n=!1,d.removeClass("v"),d.prev(".js-carousel-arrows").removeClass("v"),d.prev(".js-carousel-arrows").addClass("h"),h&&(h.html(B.arrowClasses.content.fwd),g.html(B.arrowClasses.content.back)),i&&(i.css("height","100%"),i.css("width","100%")),q="left",d.find("."+B.itemClass).css("margin-top","0px"),d.find("."+B.itemClass).css("margin-left","0px"),b("switched to horizontal bp("+o+"), w("+c+")"),p&&p(n)):m&&c>=o&&(null==n||0==n)&&(n=!0,d.addClass("v"),d.prev(".js-carousel-arrows").removeClass("h"),d.prev(".js-carousel-arrows").addClass("v"),h&&(h.html(B.arrowClasses.content.down),g.html(B.arrowClasses.content.up)),i&&(i.css("height","100%"),i.css("width","100%")),q="top",d.find("."+B.itemClass).css("margin-top","0px"),d.find("."+B.itemClass).css("margin-left","0px"),b("switched to vertical bp("+o+"), w("+c+")"),p&&p(n))},F=function(){if(A)return void b("!resize (swiping)");E();var a=n?d.height():d.width(),c=null,e=i.find("."+B.itemClass).first(),c=n?e.outerHeight():e.outerWidth(),f=parseInt(a/(c+j));f=Math.min(f,v),l=j,1==f?(l=(a-c)/2,l+=2):l=(a-f*c)/(f-1),l=parseInt(l),s=f,i.find("."+B.itemClass).css("margin-"+q,parseInt(l)+"px"),1!=f&&i.find("."+B.itemClass+":first").css("margin-"+q,"0px"),i.css(n?"height":"width",a+u*(c+l)),D()},G=function(){g&&(1==t?g.addClass("arrow-hidden"):g.removeClass("arrow-hidden")),h&&(v>t-1+s?h.removeClass("arrow-hidden"):h.addClass("arrow-hidden"))},H=function(){r=!0;var a=1>t-s?1:t-s;b("prev index = "+a),t=a,a=i.find("."+B.itemClass+":nth-child("+a+")"),i.css(q,"0"),d.scrollTo(a,1==s?0:1e3,{onAfter:function(){var a=function(){r=!1,G()};1==s?(i.find("."+B.itemClass+":first").css("margin-"+q),i.css(q,l+"px")):i.css(q,"0"),a()}})},I=function(){var a=t+s,c=i.find("."+B.itemClass+":nth-child("+a+")");return 0==c.length?(b("cannot scroll forward (return)"),d.removeClass("loading"),void G()):(t=a,i.css(q,"0"),r=!0,void d.scrollTo(c,1==s?0:1e3,{onAfter:function(){var a=function(){d.removeClass("loading"),r=!1,G()};1==s?i.css(q,l+"px"):i.css(q,"0"),a()}}))},J=function(){u>t+s+s?(b("goFwd >> scrollFwd:   (position + inView) < totalLoaded			 ("+t+" + "+s+") < "+u),I()):K(!0)},K=function(a){return k?d.hasClass("loading")?void b("already loading (return)"):u==v?(b("no more to load (scroll and return)"),void(A||I())):(d.addClass("loading ("+s+")"),void e.append(function(c){u=e.getDataCount(),c?(F(),b("added > resize > scroll "+a),a?I():d.removeClass("loading"),u==v&&b("loaded all")):0===c?b("loaded all (added 0)"):(b("load error: only "+u+" available"),v=u,d.removeClass("loading"),A||I())},s)):void b("no load url (return)")},L=function(){g=a('<a class="'+B.arrowClasses.back+'">'+(n?B.arrowClasses.content.up:B.arrowClasses.content.back)+"</a>"),h=a('<a class="'+B.arrowClasses.fwd+'">'+(n?B.arrowClasses.content.down:B.arrowClasses.content.fwd)+"</a>"),d.before('<div class="'+B.arrowClasses.container+(n?" v":" h")+'"></div>'),d.prev("."+B.arrowClasses.container).append(g),d.prev("."+B.arrowClasses.container).append(h),u=i.find("."+B.itemClass).length,g.click(function(a){return r||H(),a.stopPropagation(),!1}),h.click(function(a){return r||J(),a.stopPropagation(),!1})};return C(),{resize:function(){F()},isVertical:function(){return n},vChange:function(a){p=a},inView:function(){return fnInView()},goLeft:function(){console.error("deprecated function call in eu-carousel: goLeft"),H()},goRight:function(){console.error("deprecated function call in eu-carousel: goRight"),J()}}};return{create:function(a,b,c){return d(a,b,c)}}});